<html>
<head>
    <title>Chronos Project - Simulator</title>

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/sockjs-0.3.min.js"></script>
    <script src="/static/js/crel.js"></script>
    <script src="/static/js/json.human.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/targets.css"rel="stylesheet">

</head>
<body>
<div class="col-sm-12">


<div id="container" class="data-close controls-close set-speed view-2D zoom-close">
    
  <div class="row">
      <div id="navbar">

        <h1>Choose your destination</h1>

      </div>
  </div>
  <div class="row" style="margin-top:20px;">
    <div id="data" style="padding-top:45px;">
      <div class="row" >
        {% for t in targets %}
          {% if t['slug'] == 'earth' %}
          <a class="{{escape(t['slug'])}} active bodies-link" data-id="{{escape(str(t['id']))}}" title="{{escape(t['slug'])}}" href="#{{escape(t['slug'])}}speed" id="init">{{escape(t['name'])}}</a>
          {% else %}
          <a class="{{escape(t['slug'])}} bodies-link" data-id="{{escape(str(t['id']))}}" title="{{escape(t['slug'])}}" href="#{{escape(t['slug'])}}speed">{{escape(t['name'])}}</a>
          {% end %}
        {% end %}
      </div>
      <hr>
      <div class="row">
        <a class="btn btn-primary" id="design" title="go" destination="earth">Design Mission</a>  
      </div>
    </div>
  </div>

  <div class="row" style="height:85%;" style="margin-bottom:40px;">
    <div class="col-sm-12">
      <div id="controls" style="width:350px; height:60%;border:1px solid #FFF;">
        <div class="row" style="margin-bottom:15px;">
          <div class="col-sm-6">
              <a class="btn" id="description" query="get_target">Description</a>
          </div>
          <div class="col-sm-6">
              <a class="btn" id="physics" query="get_physics">Data</a>
          </div>
        </div>
        <div class="row"> 
          <div class="col-sm-12" id="controls-data">

          </div>
        </div>
      </div>
    </div>
      <div id="universe" class="scale-stretched">
        <div id="galaxy">
          <div id="solar-system" class="earth">
            <div id="mercury" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="venus" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="earth" class="orbit">
              <div class="pos">
                <div class="orbit">
                  <div class="pos">
                    <div class="moon"></div>
                  </div>
                </div>
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="mars" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="jupiter" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="saturn" class="orbit">
              <div class="pos">
                <div class="planet">
                  <div class="ring"></div>
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="uranus" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="neptune" class="orbit">
              <div class="pos">
                <div class="planet">
                  <dl class="infos">
                    <dd><span></span></dd>
                  </dl>
                </div>
              </div>
            </div>
            <div id="sun">
              <dl class="infos">
                <dd><span></span></dd>
              </dl>
            </div>
          </div>
        </div>
      </div>
  </div> <!-- close row -->

</div><!-- close container -->
</div> <!-- close col-sm-12 -->

<script type="text/javascript">

/* Opening Socket */

msg = 'shake hand ' + Math.random();

var recInterval = null;
var sock = null;
var host = 'http://simulation.spacexplore.it:8080/connect'

var send_ack = function(msg){
  if (sock && sock.readyState === 1) {
        sock.send(msg);
           }
  else console.log('not OPEN')
}

var connect = function(url, auth_json) {

    sock = new SockJS(url, null, { 'debug': true,
        'protocols_whitelist': ['xdr-streaming', 'xhr-streaming', 'iframe-eventsource', 'iframe-htmlfile', 'xdr-polling', 'xhr-polling', 'iframe-xhr-polling', 'jsonp-polling']
    });

    sock.onopen = function() {
        console.log(msg)
        //console.log(sock.readyState)
        //sock.send(auth_json);
        clearInterval(recInterval);
        send_ack('{"query": "get_target", "object": "' + $('#init').attr("data-id") + '"}');
    };
    sock.onmessage =  function (e) {
        data = jQuery.parseJSON(e.data);
        console.log(data)
        if(data.data.code == 1){$('#controls-data').text("no data for this body");}
        else if (data.data_type == 'get_target') {
          $('#controls').attr('body', data.data.id)
          $('#controls-data').text("");

          $('#controls-data').append('<img class="media-object img-rounded img-responsive" src="'+data.data.image_url+'"/>');
          $('#controls-data').append('<p>'+data.data.characteristics+'</p>');

        }
        else if (data.data_type == 'get_physics'){
          $('#controls-data').text("");
          delete data.data.target
          delete data.data.discover
          delete data.data.name
          var physics = JsonHuman.format(data.data);
          //console.log(physics)
          $('#controls-data').append('<div id="t-resp" class="table-responsive"></div>');
          $('#t-resp').append(physics);
        }
        else { 
          //data = jQuery.parseJSON(e.data);
          console.log(data)
          //console.log(sock.readyState)
        }
    };
    sock.onclose =  function () {
        console.log('socket closed')
        recInterval = setInterval(function () {
            connect(host, msg);
        }, 2000);
    };
  /*
  for(var i = 1; i < 16; i++){
     acknow = {'acknow': i} 
     setInterval(sock.send(acknow), 500)
  }*/
 
}

connect(host, msg);

 
  $('#design').on('click', function(e) {
    send_ack('{"query": "destination", "object": "' + $(this).attr("destination") + '"}')
    $('#container').css('display', 'none');
    e.defaultPrevented;
  });

/* Info Updating */

  var solarsys = $("#solar-system");

  $(".bodies-link").on('click', function(e) {
    /* show panel data */
    var ref = $(this).attr("title");
    $('#design').attr("destination", ref)
    console.log($('#design').attr("destination"))
    solarsys.removeClass().addClass(ref);
    $(this).parent().find('a').removeClass('active');
    $(this).addClass('active');
    e.defaultPrevented;
    
    /* send ack */
    send_ack('{"query": "get_target", "object": "' + $(this).attr("data-id") + '"}')
  });

  $('#description').on('click', function(e) {
    var id = $(this).parent().parent().parent().attr('body')
    send_ack('{"query": "get_target", "object": "' + id + '"}')
    e.defaultPrevented;
  });

  $('#physics').on('click', function(e) {
    var id = $(this).parent().parent().parent().attr('body')
    send_ack('{"query": "get_physics", "object": "' + id + '"}')
    e.defaultPrevented;
  });

</script>

<style type="text/css">

#controls-data {
  color: #fff;
  font-size: 14px;
}

#controls-data > p {
  text-align: center;
}

img {
  margin: auto auto 10px;width:150px;height:auto;
}

#json-table {
  color: #fff;
  font-size:14px;
}

.jh-value > span{
  padding-left:10px;
  margin-left:10px;
}

/*
  Copyright (c) 2012 Julian Garnier
  Licensed under the MIT license
  @JulianGarnier
*/

/* --------------------------------------------------------------------------- text infos data */

/* --------------------------------------------------------------------------- speed, circum, distances */

.set-speed #sun dl.infos dd:after {
  content: 'Orbit Velocity: \A 0 km/h \A Equatorial Circum.: \A 4,370,005 km \A Distance From Sun: \A 0 Km \A From Earth: \A 149,598,262 km';
  white-space: pre; }

.set-speed #mercury dl.infos dd:after {
  content: 'Orbit Velocity: 170,503 km/h \A Equatorial Circum.: 15,329 km \A Distance From Sun: 57,909,227 km \A From Earth: np'; 
  white-space: pre;}

.set-speed #venus dl.infos dd:after {
  content: 'Orbit Velocity: 126,074 km/h \A Equatorial Circum.: 38,024 km \A Distance From Sun: 108,209,475 km \A From Earth: np'; 
  white-space: pre; }

.set-speed #earth dl.infos dd:after {
  content: 'Orbit Velocity: 107,218 km/h \A Equatorial Circum.: 40,030 km \A Distance From Sun: 149,598,262 km \A From Earth: 0 Km'; 
  white-space: pre; }

.set-speed #mars dl.infos dd:after {
  content: 'Orbit Velocity: 86,677 km/h \A Equatorial Circum.: 21,296 km \A Distance From Sun: 227,943,824 km \A From Earth: np'; 
  white-space: pre; }

.set-speed #jupiter dl.infos dd:after {
  content: 'Orbit Velocity: 47,002 km/h \A Equatorial Circum.: 439,263 km \A Distance From Sun: 778,340,821 km \A From Earth: np'; 
  white-space: pre; } 

.set-speed #saturn dl.infos dd:after {
  content: 'Orbit Velocity: 34,701 km/h \A Equatorial Circum.: 365,882 km \A Distance From Sun: 1,426,666,422 km \A From Earth: np'; 
  white-space: pre;}

.set-speed #uranus dl.infos dd:after {
  content: 'Orbit Velocity: \A 24,477 km/h \A Equatorial Circum.: \A 159,354 km \A Distance From Sun: \A 2,870,658,186 km \A From Earth: \A np'; 
  white-space: pre;}

.set-speed #neptune dl.infos dd:after {
  content: 'Orbit Velocity: \A 19,566 km/h \A Equatorial Circum.: \A 154,704 km \A Distance From Sun: \A 4,498,396,441 km \A From Earth: \A np'; 
  white-space: pre;}

</style>

</body>
</html>

